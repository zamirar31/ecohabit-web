<div class="registro-container">
  <div
    class="registro-card"
    role="form"
    aria-labelledby="registro-title"
  >
    <div class="registro-header">
      <div class="logo" aria-hidden="true">ğŸŒ±</div>
      <h1 id="registro-title">Ãšnete a EcoHabit</h1>
      <p>Comienza tu viaje sostenible hoy</p>
    </div>

    <!-- Pasos del registro como lista accesible -->
    <div
      class="progress-steps"
      role="list"
      aria-label="Progreso del registro en dos pasos"
    >
      <div
        [class.step]="true"
        [class.active]="step >= 1"
        [class.completed]="step > 1"
        role="listitem"
        [attr.aria-current]="step === 1 ? 'step' : null"
        aria-label="Paso 1: Datos personales"
      >
        <span class="step-number">1</span>
        <span class="step-label">Datos</span>
      </div>

      <div
        class="progress-line"
        [class.completed]="step > 1"
        aria-hidden="true"
      ></div>

      <div
        [class.step]="true"
        [class.active]="step >= 2"
        [class.completed]="step > 2"
        role="listitem"
        [attr.aria-current]="step === 2 ? 'step' : null"
        aria-label="Paso 2: Seguridad de la cuenta"
      >
        <span class="step-number">2</span>
        <span class="step-label">Seguridad</span>
      </div>
    </div>

    <form
      [formGroup]="registroForm"
      (ngSubmit)="onSubmit()"
      class="registro-form"
      aria-describedby="registro-description"
    >
      <p id="registro-description" class="sr-only">
        Formulario de registro en dos pasos. Primero datos personales y luego seguridad de la cuenta.
      </p>

      <!-- MENSAJES ACCESIBLES -->
      <div
        *ngIf="successMessage"
        class="success-message"
        role="status"
        aria-live="polite"
      >
        <span class="success-icon" aria-hidden="true">âœ…</span>
        {{ successMessage }}
      </div>

      <div
        *ngIf="error"
        class="error-message"
        role="alert"
        aria-live="assertive"
      >
        <span class="error-icon" aria-hidden="true">âš ï¸</span>
        {{ error }}
      </div>

      <!-- PASO 1: DATOS -->
      <div *ngIf="step === 1" class="form-step" aria-label="Paso 1: Datos personales">
        <div class="form-group">
          <label for="nombre">Nombre Completo</label>
          <div class="input-wrapper">
            <span class="input-icon" aria-hidden="true">ğŸ‘¤</span>
            <input
              type="text"
              id="nombre"
              formControlName="nombre"
              placeholder="Juan PÃ©rez"
              class="form-input"
              [class.error]="registroForm.get('nombre')?.touched && registroForm.get('nombre')?.invalid"
              autocomplete="name"
              aria-required="true"
            />
          </div>
          <small
            *ngIf="registroForm.get('nombre')?.touched && registroForm.get('nombre')?.invalid"
            class="error-text"
            role="alert"
          >
            El nombre debe tener al menos 2 caracteres
          </small>
        </div>

        <div class="form-group">
          <label for="email">Correo ElectrÃ³nico</label>
          <div class="input-wrapper">
            <span class="input-icon" aria-hidden="true">ğŸ“§</span>
            <input
              type="email"
              id="email"
              formControlName="email"
              placeholder="tu@correo.com"
              class="form-input"
              [class.error]="registroForm.get('email')?.touched && registroForm.get('email')?.invalid"
              autocomplete="email"
              aria-required="true"
            />
          </div>
          <small
            *ngIf="registroForm.get('email')?.touched && registroForm.get('email')?.invalid"
            class="error-text"
            role="alert"
          >
            Por favor ingresa un email vÃ¡lido
          </small>
        </div>

        <div class="form-group">
          <label for="bio">Sobre ti (opcional)</label>
          <textarea
            id="bio"
            formControlName="bio"
            placeholder="CuÃ©ntanos sobre ti y tus intereses ambientales"
            class="form-input textarea"
          ></textarea>
        </div>
      </div>

      <!-- PASO 2: SEGURIDAD -->
      <div *ngIf="step === 2" class="form-step" aria-label="Paso 2: Seguridad de la cuenta">
        <div class="form-group">
          <label for="password">ContraseÃ±a</label>
          <div class="input-wrapper">
            <span class="input-icon" aria-hidden="true">ğŸ”’</span>
            <input
              [type]="showPassword ? 'text' : 'password'"
              id="password"
              formControlName="password"
              placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
              class="form-input"
              [class.error]="registroForm.get('password')?.touched && registroForm.get('password')?.invalid"
              (input)="onPasswordChange()"
              autocomplete="new-password"
              aria-required="true"
            />
            <button
              type="button"
              class="toggle-password"
              (click)="togglePassword()"
              [attr.aria-pressed]="showPassword"
              [attr.aria-label]="showPassword ? 'Ocultar contraseÃ±a' : 'Mostrar contraseÃ±a'"
            >
              {{ showPassword ? 'ğŸ‘ï¸â€ğŸ—¨ï¸' : 'ğŸ‘ï¸' }}
            </button>
          </div>
          <small
            *ngIf="registroForm.get('password')?.touched && registroForm.get('password')?.invalid"
            class="error-text"
            role="alert"
          >
            La contraseÃ±a debe tener al menos 8 caracteres
          </small>
          <div
            *ngIf="passwordStrength"
            [class]="'password-strength ' + passwordStrength"
            role="status"
            aria-live="polite"
          >
            Fortaleza: {{ passwordStrength }}
          </div>
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirmar ContraseÃ±a</label>
          <div class="input-wrapper">
            <span class="input-icon" aria-hidden="true">ğŸ”’</span>
            <input
              [type]="showPassword ? 'text' : 'password'"
              id="confirmPassword"
              formControlName="confirmPassword"
              placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
              class="form-input"
              [class.error]="registroForm.get('confirmPassword')?.touched && (registroForm.get('confirmPassword')?.invalid || registroForm.hasError('passwordMismatch'))"
              autocomplete="new-password"
              aria-required="true"
            />
          </div>
          <small
            *ngIf="registroForm.hasError('passwordMismatch') && registroForm.get('confirmPassword')?.touched"
            class="error-text"
            role="alert"
          >
            Las contraseÃ±as no coinciden
          </small>
        </div>

        <div class="form-group checkboxes">
          <label class="checkbox">
            <input
              type="checkbox"
              formControlName="terms"
              aria-required="true"
              aria-label="Aceptar tÃ©rminos y condiciones"
            />
            <span>
              Acepto los
              <a href="#">
                tÃ©rminos y condiciones
              </a>
            </span>
          </label>
          <small
            *ngIf="registroForm.get('terms')?.touched && registroForm.get('terms')?.invalid"
            class="error-text"
            role="alert"
          >
            Debes aceptar los tÃ©rminos para continuar
          </small>

          <label class="checkbox">
            <input
              type="checkbox"
              formControlName="newsletter"
              aria-label="Quiero recibir consejos y actualizaciones por correo"
            />
            <span>Quiero recibir consejos y actualizaciones por correo</span>
          </label>
        </div>
      </div>

      <!-- ACCIONES (BOTONES) -->
      <div class="form-actions">
        <button
          type="button"
          class="btn-secondary"
          *ngIf="step > 1"
          (click)="prevStep()"
          aria-label="Volver al paso anterior"
        >
          â† Anterior
        </button>

        <button
          type="button"
          class="btn-primary"
          *ngIf="step < 2"
          (click)="nextStep()"
          [disabled]="step === 1 && (registroForm.get('nombre')?.invalid || registroForm.get('email')?.invalid)"
          [attr.aria-disabled]="step === 1 && (registroForm.get('nombre')?.invalid || registroForm.get('email')?.invalid)"
          aria-label="Ir al siguiente paso del registro"
        >
          Siguiente â†’
        </button>

        <button
          type="submit"
          class="btn-submit"
          *ngIf="step === 2"
          [disabled]="registroForm.invalid || loading"
          [attr.aria-disabled]="registroForm.invalid || loading"
          aria-label="Crear cuenta en EcoHabit"
        >
          <span *ngIf="!loading">Crear Cuenta</span>
          <span *ngIf="loading" class="loading-spinner">
            Creando...
          </span>
        </button>
      </div>
    </form>

    <div class="login-link">
      Â¿Ya tienes cuenta?
      <a
        routerLink="/login"
        aria-label="Ir a la pÃ¡gina de inicio de sesiÃ³n"
      >
        Inicia sesiÃ³n
      </a>
    </div>
  </div>

  <div class="decoration flower-1" aria-hidden="true">ğŸŒ»</div>
  <div class="decoration flower-2" aria-hidden="true">ğŸŒ»</div>
</div>
